<rv-content-pane
    close-panel="self.closeLoaderFile()"
    floating-header="true"
    flow-drag-enter="self.dropActive = true"
    flow-drag-leave="self.dropActive = false"
    flow-prevent-drop
    class="rv-file-drop"
    ng-class="{'rv-file-drop-active': self.dropActive}">

    <!-- TODO: add translate filters -->

    <div
        class="rv-loader-file"
        flow-init="{ singleFile: true }">
        <!-- add `, permanentErrors: [200, 201, 202, 404, 415, 500, 501], successStatuses: []`
         to flow-init to simulate error during upload  -->

        <div class="rv-file-drop-blur">

            <rv-stepper-item
                class="rv-loader-file-upload"
                step="self.upload.step"
                form="self.upload.form"
                summary-value="{{ self.upload.file && self.upload.step.isCompleted ? self.upload.file.name : 'GeoJSON, CSV, or Shapefile' }}">

                <md-input-container class="md-block rv-loader-file-upload-drop" flex>

                    <div class="md-block">
                        <div
                            flow-files-submitted="self.upload.filesSubmitted($files, $event, $flow)"
                            flow-file-success="self.upload.fileSuccess($file, $flow)"
                            flow-error="self.upload.fileError($file, $message, $flow)">

                            <md-button
                                class="rv-button-square rv-loader-file-select-button md-raised"
                                flow-btn
                                flow-progress="console.log()"
                                flow-attrs="{ accept: '.csv,.zip,.json' }"
                                ng-click="self.upload.fileReset();self.upload.fileUrlReset()">
                                <md-icon md-svg-src="file:file_upload"></md-icon>choose a file</md-button>
                        </div>
                        <span class="md-caption">Drop the file to upload</span>
                    </div>

                    <md-progress-linear
                        md-mode="determinate"
                        value="{{ self.upload.file ? self.upload.file.progress() * 100 : 0 }}"
                        ng-class="{ 'rv-hide': !self.upload.file }"></md-progress-linear>

                    <!-- this field is needed to attach the error messages; is't hidden -->
                    <input name="fileSelect" ng-model="self.upload.fileSelect">
                    <div ng-messages="self.upload.form.fileSelect.$error" ng-if="self.upload.form.fileSelect.$invalid">
                        <div ng-message="upload-error">Can't access file.</div>
                    </div>
                </md-input-container>

                <span class="md-subhead rv-loader-file-upload-or">or</span>

                <md-input-container class="md-block">
                    <label>File URL</label>
                    <input
                        name="fileUrl"
                        type="url"
                        ng-focus="self.upload.fileReset()"
                        ng-model="self.upload.fileUrl"
                        ng-model-options="{ updateOn: 'default blur', debounce: { default: 300, blur: 0 } }"
                        required>

                    <!-- TODO: decide whether and how to display a hint or error messages -->
                    <div ng-messages="self.upload.form.fileUrl.$error">
                        <div ng-message="url">This is not a valid URL</div>
                    </div>
                </md-input-container>

            </rv-stepper-item>

            <rv-stepper-item
                form="self.select.form"
                step="self.select.step"
                summary-value="{{ self.select.dataType && self.select.step.isCompleted ? self.dataTypes[self.select.dataType] : '' }}">

                <md-input-container class="md-block">
                    <label>File Format</label>
                    <md-select name="dataType" ng-model="self.select.dataType" required>
                        <md-option ng-repeat="(value, key) in self.dataTypes" value="{{ value }}">
                            {{ key }}
                        </md-option>
                    </md-select>

                    <!-- TODO: decide whether and how to display a hint or error messages; can use md-on-close="self.select.form.dataType.$setDirty()" -->
                    <!--div
                        ng-messages="self.select.form.dataType.$error"
                        ng-if="self.select.form.dataType.$dirty">
                        <div ng-message="required">Required</div>
                    </div>
                    <div class="rv-hint">Tell us what it is.</div-->

                </md-input-container>
            </rv-stepper-item>

            <rv-stepper-item step="self.configure.step" form="self.configure.form" ng-switch on="self.select.dataType">

                <md-input-container class="md-block">
                    <label>Layer Name</label>
                    <input name="layerName" ng-model="self.configure.options.layerName" required>
                    <!-- TODO: decide whether and how to display a hint or error messages -->
                    <!--div ng-messages="self.configure.form.layerName.$error">
                        <div ng-message="required">This is required!</div>
                        <div ng-message="md-maxlength">That's too long!</div>
                    </div-->
                </md-input-container>

                <md-input-container class="md-block">
                    <label>Primary Field</label>
                    <md-select name="primaryField" ng-model="self.configure.options.primaryField" required>
                        <md-option ng-repeat="(value, key) in self.fields" value="{{ value }}">
                            {{ key }}
                        </md-option>
                    </md-select>
                    <!-- TODO: decide whether and how to display a hint or error messages -->
                    <!--div  ng-messages="self.configure.form.primaryField.$error">
                        <div ng-message="required">Required</div>
                    </div-->
                </md-input-container>

                <div layout="row" ng-switch-when="csv">
                    <md-input-container class="md-block" flex>
                        <label>Latitude Field</label>
                        <md-select name="latitude" ng-model="self.configure.options.latitude" required>
                            <md-option ng-repeat="(value, key) in self.fields" value="{{ value }}">
                                {{ key }}
                            </md-option>
                        </md-select>
                        <!-- TODO: decide whether and how to display a hint or error messages -->
                        <!--div ng-messages="self.configure.form.latitude.$error">
                            <div ng-message="required">Required</div>
                        </div-->
                    </md-input-container>
                    <md-input-container class="md-block" flex>
                        <label>Longitude Field</label>
                        <md-select name="longitude" ng-model="self.configure.options.longitude" required>
                            <md-option ng-repeat="(value, key) in self.fields" value="{{ value }}">
                                {{ key }}
                            </md-option>
                        </md-select>
                        <!-- TODO: decide whether and how to display a hint or error messages -->
                        <!--div  ng-messages="self.configure.form.longitude.$error">
                            <div ng-message="required">Required</div>
                        </div-->
                    </md-input-container>
                </div>

            </rv-stepper-item>
        </div>

        <div class="rv-file-drop-container" flow-drop>
            <div class="rv-file-drop-title">
                <span class="md-display-2">Drop the file to upload</span>
                <md-icon md-svg-src="file:file_upload"></md-icon>
            </div>
        </div>
    </div>

</rv-content-pane>
